
#title Archive for June, 2019

#p0
#date 18年6月10日 周日 11:59

## 更换 Markdown Engine 为 cmark-gfm

将本地 Markdown 渲染引擎换成了 [cmark-gfm](https://github.com/github/cmark-gfm)，在这个基础上建立了类 EmacsWikiMode 的工程生成工具 
[MarkdownProjectCompositor](https://github.com/lalawue/MarkdownProjectCompositor)。

之前这个主页包括博客，是 2004 年底因为好奇 Wiki 语法而搭建起来的本地 HTML 文件，后来又学会了使用 FTP 上传免费的空间，绑定二级域名。

接着又学会了如何买域名，大学时代迷恋 Unix、Linux、Emacs 等等这一切对于普通人来说奇奇怪怪的东西，除了头脑发热在学校 BBS 上各种水文，
还在这里分门别类做了记录，慢慢的东西就多起来了。

这十多年间，不变的是，我得使用 Emacs 作为一个所见所得的编辑器，通过
[EmacsWikiMode](https://github.com/lalawue/emacs-wiki-mode) 来写 Markdown，
为此自己在这个 mode 之上建立了 [EmacsWikiJournal](https://github.com/lalawue/emacs-wiki-journal) 来专门写博客，基本上，
[这个过程还是很方便的](scratch#EmacsWiki)。

Markdown 最初的语法，都来自于 JOHN GRUBER 在 2004 年的 
[Markdown: Syntax](https://daringfireball.net/projects/markdown/syntax)。

因为 EmacsWikiMode 引用得早吧，所以在此之上，构建了很多独特的功能，比如自动生成目录摘要，比如将 Markdown 组织为各个工程，使用不同的配置文件头、
文件尾来生成 HTML，这样不同目录下的 HTML 可以使用不同的 CSS。而且，不同工程之间还可以很方便的引用。以及各种语法的高亮，将其输出为 HTML 文件。

也是蛮早，我就想着将博客的文件按照 YYYY-MM 这样组织，可以经受时间推移的考验，可是没想到，最大的不确定性，来自于 Emacs 的支持。

一方面，EmacsWikiMode 早就年久失修，maintainer 在 N 年以前，就构建了一个叫做 muse 的工程另起炉灶了。而 Emacs 社区本身，转到了 OrgMode 这一条路上
面，再说，其实一直都有 OutlineMode 可以用，也还勉勉强强。

加上外面各种 Markdown 桌面软件，网页端工具提供方便的界面，EmacsWikiMode 早就没有人用了，而我自己使用的频次也是越拉越少。

可悲的是，随着 Emacs 版本更新，大概在 version 24 的时候，EmacsWikiMode 在使用上就各种问题，version 25 之后，几乎无法生成了。

虽然是低频使用，但考虑到需要很长时间的支持，emacs-lisp 这种语言就得花费很多时间去维护，其作为 Emacs 环境编程工具，功能接口变动较大，
如果是 C 等等语言、库变动少的，基本上靠着 POSIX Like 的系统接口，维护成本可以很低。当然效率是另外一方面的加分吧。

所以，替换 Markdown 的 renderinig engine，随着 Emacs 上 EmacsWikiMode 的可用性变得迫切起来，最终来了这次大改。

因为之前 EmacsWikiMode 功能丰富，加上自救对于 cmark 还不熟悉，所以功能上有取舍。另外之前为了在上面构建 EmacsWikiJournal，其实在 HTML 文件结构上
面，以及 Markdown 的语法上面，都有一些不妥的地方，这里一并修改过来了。

先说一些缺失的：  
- 不再支持生成 table 了，原来的 table 都是从 HTML 层面拷贝过来的
- 没有区分各种语言的语法高亮了[1](#fn1)
- 博客没有侧边栏的 calendar 了

一些依旧支持，并做了改进的：  
- 支持工程间的引用
- 支持生成目录摘要
- 支持 footnote
- 博客里面良好的 HTML 标题结构、date、category 语法[2](#fn2)
- 动态生成 WelcomePage、Category 内容

[1](#fn1) [emacs-lisp 语法高亮图](images#elisp_highlight_syntax.jpg)  
[2](#fn2) [新的博客结构](images#md_cmark_syntax.jpg)

#category ThisSite